<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة قتال</title>
    <style>
        #gameCanvas {
            border: 1px solid black;
        }

        /* شاشة اختيار الشخصية */
        .character-selection {
            display: none;
            text-align: center;
            margin-top: 50px;
        }

        .character-button {
            margin: 20px;
            padding: 10px 20px;
            border: none;
            background-color: lightgray;
            font-size: 20px;
            cursor: pointer;
        }

        .game-screen {
            display: none;
        }

        .control-buttons {
            position: fixed;
            bottom: 10px;
            left: 10px;
        }

        .control-button {
            width: 50px;
            height: 50px;
            margin: 5px;
            background-color: lightgray;
            border: none;
            font-size: 20px;
            border-radius: 50%;
        }

        .fire-button {
            position: fixed;
            bottom: 10px;
            right: 10px;
            width: 80px;
            height: 80px;
            background-color: red;
            color: white;
            font-size: 20px;
            border: none;
            border-radius: 50%;
        }
    </style>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
    <div id="selectionScreen" class="character-selection">
        <h1>اختر شخصيتك</h1>
        <button class="character-button" id="character1">شخصية 1</button>
        <button class="character-button" id="character2">شخصية 2</button>
    </div>

    <div id="gameScreen" class="game-screen">
        <h1>لعبة قتال بسيطة</h1>
        <canvas id="gameCanvas" width="800" height="600"></canvas>

        <!-- أزرار التحكم للاعب 1 -->
        <div class="control-buttons" id="controlsPlayer1">
            <button class="control-button" id="upBtn1">↑</button><br>
            <button class="control-button" id="leftBtn1">←</button>
            <button class="control-button" id="downBtn1">↓</button>
            <button class="control-button" id="rightBtn1">→</button>
        </div>

        <!-- زر إطلاق النار للاعب 1 -->
        <button class="fire-button" id="fireBtn1">إطلاق</button>

        <!-- أزرار التحكم للاعب 2 -->
        <div class="control-buttons" id="controlsPlayer2">
            <button class="control-button" id="upBtn2">↑</button><br>
            <button class="control-button" id="leftBtn2">←</button>
            <button class="control-button" id="downBtn2">↓</button>
            <button class="control-button" id="rightBtn2">→</button>
        </div>

        <!-- زر إطلاق النار للاعب 2 -->
        <button class="fire-button" id="fireBtn2">إطلاق</button>
    </div>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAgv4ga8tVfSjo-t_i4s6QrWMKwtLE5B1w",
            authDomain: "wqty-dfc7b.firebaseapp.com",
            databaseURL: "https://wqty-dfc7b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "wqty-dfc7b",
            storageBucket: "wqty-dfc7b.appspot.com",
            messagingSenderId: "445541680133",
            appId: "1:445541680133:web:0a6a3368f222542e1a886c"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Game and player data
        let player1 = { x: 100, y: 100, width: 50, height: 50, color: 'blue', speed: 5, health: 100, bullets: [] };
        let player2 = { x: 600, y: 100, width: 50, height: 50, color: 'red', speed: 5, health: 100, bullets: [] };
        const bulletSpeed = 8;
        const maxDistanceToHit = 200;

        // Screen elements
        const selectionScreen = document.getElementById('selectionScreen');
        const gameScreen = document.getElementById('gameScreen');

        // Show game screen when both players have selected characters
        function startGame() {
            selectionScreen.style.display = 'none';
            gameScreen.style.display = 'block';
        }

        // Handle character selection
        document.getElementById('character1').addEventListener('click', () => {
            db.ref('players/player1').set({ character: 'Character1' });
            checkIfBothPlayersReady();
        });

        document.getElementById('character2').addEventListener('click', () => {
            db.ref('players/player2').set({ character: 'Character2' });
            checkIfBothPlayersReady();
        });

        function checkIfBothPlayersReady() {
            db.ref('players').once('value', (snapshot) => {
                const data = snapshot.val();
                if (data.player1 && data.player2) {
                    if (data.player1.character && data.player2.character) {
                        startGame();
                    }
                }
            });
        }

        // Sync player data with Firebase
        function updatePlayerInDB(playerNumber, playerData) {
            db.ref('players/player' + playerNumber).set({
                x: playerData.x,
                y: playerData.y,
                health: playerData.health
            });
        }

        // Listen for changes in Firebase
        db.ref('players').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data.player1) {
                player1.x = data.player1.x;
                player1.y = data.player1.y;
                player1.health = data.player1.health;
            }
            if (data.player2) {
                player2.x = data.player2.x;
                player2.y = data.player2.y;
                player2.health = data.player2.health;
            }
        });

        // Control player movement
        function handleMovement(player, direction) {
            switch (direction) {
                case 'ArrowUp':
                    player.y -= player.speed;
                    break;
                case 'ArrowDown':
                    player.y += player.speed;
                    break;
                case 'ArrowLeft':
                    player.x -= player.speed;
                    break;
                case 'ArrowRight':
                    player.x += player.speed;
                    break;
            }
            updatePlayerInDB(1, player1);
            updatePlayerInDB(2, player2);
        }

        // Functions to handle button presses on mobile for player 1
        document.getElementById('upBtn1').addEventListener('click', () => handleMovement(player1, 'ArrowUp'));
        document.getElementById('downBtn1').addEventListener('click', () => handleMovement(player1, 'ArrowDown'));
        document.getElementById('leftBtn1').addEventListener('click', () => handleMovement(player1, 'ArrowLeft'));
        document.getElementById('rightBtn1').addEventListener('click', () => handleMovement(player1, 'ArrowRight'));

        // Functions to handle button presses on mobile for player 2
        document.getElementById('upBtn2').addEventListener('click', () => handleMovement(player2, 'ArrowUp'));
        document.getElementById('downBtn2').addEventListener('click', () => handleMovement(player2, 'ArrowDown'));
        document.getElementById('leftBtn2').addEventListener('click', () => handleMovement(player2, 'ArrowLeft'));
        document.getElementById('rightBtn2').addEventListener('click', () => handleMovement(player2, 'ArrowRight'));

        // Button to fire bullets for player 1
        document.getElementById('fireBtn1').addEventListener('click', () => fire(player1));

        // Button to fire bullets for player 2
        document.getElementById('fireBtn2').addEventListener('click', () => fire(player2));

        function fire(player) {
            player.bullets.push({ x: player.x + player.width / 2, y: player.y, direction: 'up' });
        }

        // Update the game state
        function updateGame() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            
            // رسم اللاعبين
            drawPlayer(player1);
            drawPlayer(player2);

            // رسم الحواجز
            drawObstacles();

            // تحديث الرصاصات
            player1.bullets.forEach((bullet, index) => {
                bullet.y -= bulletSpeed;

                if (obstacles.some(obstacle => checkCollision(bullet, obstacle))) {
                    player1.bullets.splice(index, 1);
                } else if (checkBulletHitPlayer(bullet, player2)) {
                    player2.health -= 10;
                    player1.bullets.splice(index, 1);
                } else {
                    drawBullet(bullet);
                }
            });

            player2.bullets.forEach((bullet, index) => {
                bullet.y += bulletSpeed;

                if (obstacles.some(obstacle => checkCollision(bullet, obstacle))) {
                    player2.bullets.splice(index, 1);
                } else if (checkBulletHitPlayer(bullet, player1)) {
                    player1.health -= 10;
                    player2.bullets.splice(index, 1);
                } else {
                    drawBullet(bullet);
                }
            });

            requestAnimationFrame(updateGame);
        }

        // Initialize game
        updateGame();
    </script>
</body>
</html>
