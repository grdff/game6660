<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>لعبة قتال</title>
    <style>
        #gameCanvas {
            border: 1px solid black;
        }

        /* تحكم اللاعب */
        .control-buttons {
            position: absolute;
            bottom: 10px;
            left: 10px;
        }

        .control-button {
            width: 50px;
            height: 50px;
            margin: 5px;
            background-color: lightgray;
            border: none;
            font-size: 20px;
            border-radius: 50%;
        }

        .fire-button {
            position: absolute;
            bottom: 10px;
            right: 10px;
            width: 80px;
            height: 80px;
            background-color: red;
            color: white;
            font-size: 20px;
            border: none;
            border-radius: 50%;
        }
    </style>
    <!-- Firebase compat libraries for non-modular environments -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
</head>
<body>
    <h1>لعبة قتال بسيطة</h1>
    <canvas id="gameCanvas" width="800" height="600"></canvas>

    <!-- أزرار التحكم للاعب -->
    <div class="control-buttons">
        <button class="control-button" id="upBtn">↑</button><br>
        <button class="control-button" id="leftBtn">←</button>
        <button class="control-button" id="downBtn">↓</button>
        <button class="control-button" id="rightBtn">→</button>
    </div>

    <!-- زر إطلاق النار -->
    <button class="fire-button" id="fireBtn">إطلاق</button>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyAgv4ga8tVfSjo-t_i4s6QrWMKwtLE5B1w",
            authDomain: "wqty-dfc7b.firebaseapp.com",
            databaseURL: "https://wqty-dfc7b-default-rtdb.asia-southeast1.firebasedatabase.app",
            projectId: "wqty-dfc7b",
            storageBucket: "wqty-dfc7b.appspot.com",
            messagingSenderId: "445541680133",
            appId: "1:445541680133:web:0a6a3368f222542e1a886c"
        };

        // Initialize Firebase
        const app = firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');

        // Initialize player data
        let player1 = { x: 100, y: 100, width: 50, height: 50, color: 'blue', speed: 5, health: 100 };
        let player2 = { x: 600, y: 100, width: 50, height: 50, color: 'red', speed: 5, health: 100 };

        // Function to draw players
        function drawPlayer(player) {
            ctx.fillStyle = player.color;
            ctx.fillRect(player.x, player.y, player.width, player.height);
        }

        // Sync player data with Firebase
        function updatePlayerInDB(playerNumber, playerData) {
            db.ref('players/player' + playerNumber).set({
                x: playerData.x,
                y: playerData.y,
                health: playerData.health
            });
        }

        // Listen for changes in Firebase
        db.ref('players').on('value', (snapshot) => {
            const data = snapshot.val();
            if (data.player1) {
                player1.x = data.player1.x;
                player1.y = data.player1.y;
                player1.health = data.player1.health;
            }
            if (data.player2) {
                player2.x = data.player2.x;
                player2.y = data.player2.y;
                player2.health = data.player2.health;
            }
        });

        // Control player movement
        document.addEventListener('keydown', (e) => {
            handleMovement(e.key);
        });

        // Functions to handle button presses on mobile
        document.getElementById('upBtn').addEventListener('click', () => handleMovement('ArrowUp'));
        document.getElementById('downBtn').addEventListener('click', () => handleMovement('ArrowDown'));
        document.getElementById('leftBtn').addEventListener('click', () => handleMovement('ArrowLeft'));
        document.getElementById('rightBtn').addEventListener('click', () => handleMovement('ArrowRight'));

        function handleMovement(direction) {
            switch (direction) {
                case 'ArrowUp':
                    player1.y -= player1.speed;
                    break;
                case 'ArrowDown':
                    player1.y += player1.speed;
                    break;
                case 'ArrowLeft':
                    player1.x -= player1.speed;
                    break;
                case 'ArrowRight':
                    player1.x += player1.speed;
                    break;
            }
            updatePlayerInDB(1, player1);
        }

        // Button to fire
        document.getElementById('fireBtn').addEventListener('click', () => fire());

        function fire() {
            const distance = Math.sqrt(Math.pow(player1.x - player2.x, 2) + Math.pow(player1.y - player2.y, 2));
            const maxDistanceToHit = 10000; // المسافة المسموحة للإصابة

            if (distance <= maxDistanceToHit) {
                player2.health -= 10;
                updatePlayerInDB(2, player2);
                alert("إصابة! صحة اللاعب 2: " + player2.health);
                if (player2.health <= 0) {
                    alert("اللاعب 1 فاز!");
                    resetGame();
                }
            } else {
                alert("اللاعب بعيد جدًا للإصابة");
            }
        }

        // Reset the game
        function resetGame() {
            player1 = { x: 100, y: 100, width: 50, height: 50, color: 'blue', speed: 5, health: 100 };
            player2 = { x: 600, y: 100, width: 50, height: 50, color: 'red', speed: 5, health: 100 };
            updatePlayerInDB(1, player1);
            updatePlayerInDB(2, player2);
        }

        // Game loop to draw players
        function update() {
            ctx.clearRect(0, 0, canvas.width, canvas.height);
            drawPlayer(player1);
            drawPlayer(player2);
            requestAnimationFrame(update);
        }
        update();
    </script>
</body>
</html>
